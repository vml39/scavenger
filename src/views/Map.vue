<template>
  <div id="map">
    <div id="map-container" >
      <div id="map-background" v-bind:class="{'offset': allfilled}"  v-bind:style="{backgroundImage: 'linear-gradient(0, '+ colorArray[colorIndices[0]] + ' 0%, ' + colorArray[colorIndices[1]] + ' 50%, ' + colorArray[colorIndices[2]] + ' 100%)'}"></div>
			<div id="tokens" v-bind:class="{'expanded': lineExpanded, 'offset': allfilled}">
				<div class="line-token" v-bind:key="index" v-for="(item, index) in new Array(8)">
					<div class="line"></div>
					<div class="token" v-bind:class="{'expanded': tokenExpanded, 'collected': gainedArray.includes(index)}">
						<svg x="0px" y="0px" width="512px"
							height="512px" viewBox="0 0 512 512">
							<path class="st0" d="M204.81,163.98L204.81,163.98l50.01,50.01c5.97,5.97,5.97,15.62,0,21.59v0c-5.97,5.97-15.63,5.97-21.59,0
								l-53-53c0,0,0,0,0,0l0,0c-7.41,6.3-14.89,12.92-22.58,20.61c-13.1,13.1-25.97,29.67-38.43,47.94l0,0l70.82,70.82v0
								c5.97,5.97,5.97,15.62,0,21.59c-5.97,5.97-15.62,5.97-21.59,0l-66.18-66.18c0,0,0,0,0,0l0,0c-10.86,17.88-21.18,36.69-30.84,55.53
								l0,0c0,0,0,0,0,0l32.24,32.24c5.97,5.97,5.97,15.62,0,21.59c-5.97,5.97-15.63,5.97-21.59,0l-24.96-24.96c0,0,0,0,0,0l0,0
								c-31.29,65.25-54.59,125.3-56.2,129.76c-2.02,5.57-0.63,11.81,3.55,15.99c4.19,4.19,10.43,5.58,15.99,3.55
								c5.12-1.85,82.53-31.49,158.63-70.52l0,0l-32.24-32.24c-5.97-5.97-5.97-15.62,0-21.59c5.97-5.97,15.63-5.97,21.59,0l38.85,38.85
								c0,0,0,0,0,0l0,0c28.66-15.88,55.93-33.18,78.45-51.11l0,0l-52.52-52.52c-5.97-5.97-5.97-15.62,0-21.59
								c5.97-5.97,15.62-5.97,21.59,0l53.98,53.98h0c72.64-72.64,83.24-132.69,32.39-183.54C301.81,131.42,256.81,129.35,204.81,163.98z"
								/>
							<path class="st0" d="M493.52,113.7l3.05-3.67c10.63-12.8,16.09-29.07,15.37-45.82c-0.73-16.85-7.68-32.68-19.58-44.58
								c-11.9-11.9-27.73-18.85-44.58-19.58c-16.75-0.72-33.02,4.74-45.82,15.37l-3.67,3.05l-4.6-1.26c-17.97-4.92-37.25,0.14-50.32,13.22
								c-10.98,10.98-16.39,26.16-14.84,41.64c2.14,21.44,1.41,42.9-2.15,63.91c9.6,5.67,18.92,13.01,27.78,21.87
								c8.84,8.84,16.17,18.15,21.87,27.76c20.92-3.56,42.37-4.28,63.88-2.13c15.49,1.55,30.68-3.86,41.66-14.84
								c13.08-13.08,18.14-32.36,13.22-50.32L493.52,113.7z"/>
						</svg>
						<!-- <svg x="0px" y="0px" width="104.33px" height="104.33px" viewBox="0 0 104.33 104.33">
							<path class="st0" d="M77.47,6.56C52.28-7.42,20.53,1.67,6.56,26.86C-7.42,52.05,1.67,83.8,26.86,97.78
								c25.19,13.97,56.94,4.88,70.91-20.31C111.75,52.28,102.66,20.53,77.47,6.56z M58.4,19.97c0.93-1.68,2.72-2.74,4.66-2.76l0.5-0.01
								l0.28-0.41c0.98-1.43,2.45-2.44,4.14-2.85c1.71-0.41,3.49-0.17,5.02,0.68c1.53,0.85,2.68,2.23,3.24,3.9
								c0.55,1.65,0.47,3.44-0.22,5.02L75.81,24l0.26,0.42c1.01,1.66,1.05,3.73,0.12,5.41c-0.78,1.41-2.15,2.39-3.74,2.68
								c-2.21,0.4-4.34,1.09-6.33,2.04c-0.85-0.8-1.85-1.52-2.98-2.15c-1.14-0.63-2.28-1.1-3.41-1.39c-0.25-2.2-0.79-4.37-1.62-6.46
								C57.51,23.06,57.62,21.38,58.4,19.97z M39.26,61.32L39.26,61.32C39.26,61.32,39.26,61.32,39.26,61.32l3.21,1.78
								c0.77,0.43,1.73,0.15,2.16-0.62c0.43-0.77,0.15-1.73-0.62-2.16l-4.15-2.3c0,0,0,0,0,0l0,0c0.43-2.16,0.92-4.34,1.49-6.44
								c0,0,0,0,0,0l8.52,4.72c0.77,0.43,1.73,0.15,2.16-0.62c0.43-0.77,0.15-1.73-0.62-2.16l-9.11-5.06l0,0c0.72-2.18,1.54-4.21,2.47-5.9
								c0.55-0.99,1.11-1.87,1.67-2.71h0c0,0,0,0,0,0l6.82,3.78c0.77,0.43,1.73,0.15,2.16-0.62c0.43-0.77,0.15-1.73-0.62-2.16l-6.44-3.57v0
								c4.21-4.95,8.77-6.04,13.84-3.22c6.54,3.63,7.2,9.94,2.02,19.29l-6.95-3.85c-0.77-0.43-1.73-0.15-2.16,0.62
								c-0.43,0.77-0.15,1.73,0.62,2.16l6.76,3.75l0,0c-1.74,2.44-3.97,4.95-6.38,7.36h0c0,0,0,0,0,0l-5-2.77
								c-0.77-0.43-1.73-0.15-2.16,0.62c-0.43,0.77-0.15,1.73,0.62,2.16l4.15,2.3l0,0c-6.49,6.08-13.39,11.27-13.85,11.6
								c-0.5,0.36-1.16,0.4-1.7,0.1c-0.54-0.3-0.86-0.88-0.81-1.5C37.38,75.42,37.99,68.74,39.26,61.32z M25.35,22.64
								c1.3-3.56,2.93-5.82,6.37-7.44c2.82,6.28-0.08,14.23-6.29,17.21C23.84,28.96,24.04,26.19,25.35,22.64z M20.72,24.25
								c4.72,5.03,4.55,13.48-0.34,18.32c-2.64-2.75-3.34-5.45-3.26-9.22C17.2,29.56,17.99,26.91,20.72,24.25z M13.27,36.39
								c6.09,3.21,8.69,11.26,5.65,17.44c-3.4-1.75-4.93-4.07-6.09-7.66C11.66,42.57,11.55,39.79,13.27,36.39z M10.16,50.27
								c6.81,1.06,11.9,7.83,11.02,14.65c-3.76-0.54-5.96-2.23-8.25-5.25C10.66,56.64,9.64,54.05,10.16,50.27z M11.78,64.42
								c6.77-1.21,13.79,3.53,15.17,10.27c-3.74,0.71-6.37-0.16-9.5-2.29C14.31,70.29,12.51,68.16,11.78,64.42z M17.9,77.28
								c6-3.35,14.18-1.15,17.69,4.76c-3.31,1.89-6.09,1.92-9.75,0.94C22.19,82,19.81,80.58,17.9,77.28z M34.14,93.67
								c-1.33-1.36-1.69-2.69-1.68-4.58c0.01-0.73,0.14-1.33,0.29-1.93c-0.42,0.45-0.86,0.88-1.47,1.27c-1.6,1-2.92,1.4-4.78,0.99
								c0.8-3.34,4.36-5.58,7.71-4.89C36.57,87.01,36.56,91.22,34.14,93.67z M39.95,90.81c-2.77-2.58-4.22-4.96-4.36-8.76
								C42.46,81.9,48.65,87.67,49,94.54C45.18,94.66,42.73,93.39,39.95,90.81z M53.38,92.34c-3.47-1.54-5.6-3.3-6.98-6.85
								c6.45-2.4,14.18,1.05,16.75,7.44C59.58,94.29,56.83,93.88,53.38,92.34z M66.57,89.42c-3.77-0.33-6.38-1.3-8.83-4.22
								c5.33-4.35,13.77-3.61,18.27,1.6C73.07,89.24,70.34,89.75,66.57,89.42z M78.08,82.37c-3.66,0.91-6.45,0.84-9.72-1.12
								c3.63-5.85,11.84-7.9,17.78-4.44C84.16,80.07,81.75,81.45,78.08,82.37z M86.68,71.94c-3.16,2.06-5.83,2.9-9.55,2.11
								c1.52-6.71,8.62-11.32,15.36-9.99C91.69,67.8,89.86,69.88,86.68,71.94z M91.42,59.28c-2.33,2.99-4.57,4.64-8.35,5.11
								c-0.75-6.83,4.46-13.51,11.28-14.44C94.8,53.73,93.75,56.31,91.42,59.28z"/>
						</svg> -->
					</div>
					<div class="line"></div>		
				</div>
			</div>    
    </div>
	<div id="actions-container">
      <div class="action-button" @click="openModal('QRcode')">Scan</div>
      <div class="action-button" @click="openModal('SocialMediaTag')">Share</div>
      <div class="action-button" v-on:click="add()">Refer</div>
    </div>
	<Modal v-show="modalOpen" v-bind:selectedModal="selectedModal" @closeandcollectpoints="closeModalAndCollectPoint" @close="closeModal"/>

    <!-- <div class="popup" v-show="scanMode"></div>
    <div class="popup" v-show="shareMode"></div>
    <div class="popup" v-show="referMode"></div> -->
  </div>
</template>

<script>
	import Modal from '@/components/Modal.vue';

	export default {
		name: 'map',
		components: {
			Modal,
		},
		data() {
			return {
			scanMode: false,
			shareMode: false,
			referMode: false,
					tokens: 0,
					allfilled: false,
					lineExpanded: false,
					tokenExpanded: false,
					gainedArray: [],
					numberArray: [1, 2, 3, 4],
					colorArray: ["#ff9999", "#ffd699", "#ebff99", "#adff99", "#99ffc2", "#99ffff", "#99c2ff", "#ad99ff", "#eb99ff", "#ff99d6"],
			colorIndices: [0, 1, 2],
			
			modalOpen: false,
			selectedModal: null,
			vendors: [],
			}
		},
		methods: {
			openModal(modalSelected) {
				this.modalOpen = true;
				this.selectedModal = modalSelected;
			},
			closeModal() {
				this.modalOpen = false;
				this.selectedModal = null;
			},
			closeModalAndCollectPoint() {
				this.modalOpen = false;
				this.selectedModal = null;
				this.add();
			},
			add() {
				this.tokens ++
				this.updateGained()
			},	
			updateGained() {
				let num = this.tokens%4;
				if (num == 1) {
					this.gainedArray = [0]
				} else if (num == 2) {
					this.gainedArray = [0, 1]
				} else if (num == 3) {
					this.gainedArray = [0, 1, 2]
				} else if (num == 0 && this.tokens != 0){
					this.gainedArray = [0, 1, 2, 3]
					setTimeout(() => {
						this.allfilled = true
						setTimeout(() => {
							this.allfilled = false
							this.colorIndices.forEach((elem, index) => {
								this.colorIndices[index] = elem+1 >= this.colorArray.length ? 0 : elem+1
							})
							this.numberArray.forEach((number, index) => {
								this.numberArray[index] = number+1
							})
							this.gainedArray = []
						}, 1000)
					}, 1000)
				}
			}
		},
	
		mounted() {
			this.updateGained()
			setTimeout(() => {
				this.lineExpanded = true
				setTimeout(() => {
					this.tokenExpanded =true
				}, 1500)
			}, 500)
		},

	}	
</script>

<style lang="scss">
  @import "../css/map.scss"
</style>
